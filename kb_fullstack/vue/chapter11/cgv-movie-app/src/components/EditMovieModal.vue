<template>
  <Teleport to="#modal">
    <div v-if="isOpen" class="modal-container">
      <div>
        <div class="header">
          <h3>🎥 영화 추가하기</h3>
        </div>
        <div class="body">
          <form>
            <input type="text" v-model="movieForm.title" placeholder="제목" />
            <input type="text" v-model.number="movieForm.year" placeholder="연도" />
            <input type="text" v-model="movieForm.director" placeholder="감독" />
            <textarea v-model="movieForm.description" placeholder="줄거리" rows="3" cols="35"></textarea>
            <input type="text" v-model="movieForm.poster" placeholder="포스터 이미지 URL" />
          </form>
        </div>
        <div class="footer">
          <button @click="onSubmit">수정</button>
          <button @click="emit('on-close')">닫기</button>
        </div>
      </div>
    </div>
  </Teleport>
</template>

<script setup>
import '@/assets/modal.css';
import { putMovie } from '@/api/movie';
import { reactive, ref } from 'vue';

const isLoading = ref(false);
const emit = defineEmits(['on-close']);

const props = defineProps({
  isOpen: {
    type: Boolean,
    default: false,
  },
  movie: {
    type: Object,
    required: true,
  },
});

const movieForm = reactive({
  title: props.movie.title,
  year: props.movie.year,
  director: props.movie.director,
  description: props.movie.description,
  poster: props.movie.poster,
});

const onSubmit = async () => {
  isLoading.value = true;
  if (movieForm.title === null) {
    alert('제목을 입력해주세요!');
  } else if (movieForm.year === null) {
    alert('연도를 입력해주세요!');
  } else if (movieForm.director === null) {
    alert('감독을 입력해주세요!');
  } else if (movieForm.description === null) {
    alert('줄거리를 입력해주세요.');
  } else if (movieForm.poster === null) {
    alert('포스터 url을 추가해주세요.');
  } else {
    await putMovie(props.movie.id, movieForm);
    emit('on-close');
  }
  isLoading.value = false;
};
</script>
